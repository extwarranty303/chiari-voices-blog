import{c as T,N as q,u as P,r as h,j as e,B as m,q as x,a as f,d as n,w as u,o as k,g as p,k as g,H as z,$ as L,a0 as j}from"./index-Cwzn0Rv2.js";import{L as M,S,T as R}from"./trash-2-CxensYrn.js";import{t as B,c as C,f as _}from"./format-Dpr0NHdZ.js";const O=[["path",{d:"M3 7v6h6",key:"1v2h90"}],["path",{d:"M21 17a9 9 0 0 0-9-9 9 9 0 0 0-6 2.3L3 13",key:"1r6uu6"}]],F=T("undo",O);function H(s,r,i){const o=B(s,i?.in);return isNaN(r)?C(s,NaN):(o.setDate(o.getDate()+r),o)}function I(s,r,i){return H(s,-30,i)}function G(){const{isModerator:s,loading:r}=q(),i=P(),[o,v]=h.useState([]),[N,y]=h.useState(!0);h.useEffect(()=>{!r&&!s&&i("/")},[s,r,i]);const l=async()=>{y(!0);try{const t=x(f(n,"posts"),u("status","==","trashed"),k("trashedAt","desc")),d=(await p(t)).docs.map(c=>({id:c.id,...c.data()}));v(d)}catch(t){console.error("Error fetching trashed posts:",t)}finally{y(!1)}};h.useEffect(()=>{s&&l()},[s]);const b=async t=>{if(window.confirm("Are you sure you want to restore this post?"))try{const a=g(n,"posts",t);await z(a,{status:"draft",trashedAt:null}),l()}catch(a){console.error("Error restoring post:",a)}},A=async t=>{if(window.confirm("Are you sure you want to permanently delete this post? This action cannot be undone."))try{await L(g(n,"posts",t)),l()}catch(a){console.error("Error deleting post:",a)}},D=async()=>{if(window.confirm("Are you sure you want to permanently delete all posts in the trash? This action cannot be undone."))try{const t=x(f(n,"posts"),u("status","==","trashed")),a=await p(t),d=j(n);a.docs.forEach(c=>d.delete(c.ref)),await d.commit(),l()}catch(t){console.error("Error emptying trash:",t),alert("An error occurred while emptying the trash.")}};return h.useEffect(()=>{s&&(async()=>{try{const a=I(new Date,30),d=x(f(n,"posts"),u("status","==","trashed"),u("trashedAt","<=",a)),c=await p(d),w=j(n);c.docs.forEach(E=>w.delete(E.ref)),c.empty||(await w.commit(),l())}catch(a){console.error("Error cleaning up old trashed posts:",a)}})()},[s]),r||N?e.jsx("div",{className:"flex justify-center items-center h-[50vh]",children:e.jsx(M,{className:"animate-spin text-accent",size:40})}):s?e.jsxs("div",{className:"max-w-4xl mx-auto py-8",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h1",{className:"text-3xl font-bold text-surface",children:"Trash"}),e.jsx(m,{variant:"destructive",onClick:D,disabled:o.length===0,children:"Empty Trash"})]}),e.jsxs("div",{className:"bg-surface/5 rounded-lg overflow-hidden",children:[e.jsxs("div",{className:"flex items-center px-4 py-2 font-bold bg-surface/10 text-sm text-surface/80",children:[e.jsx("div",{className:"flex-grow",children:"Title"}),e.jsx("div",{className:"w-40 text-center",children:"Trashed Date"}),e.jsx("div",{className:"w-32 text-center",children:"Actions"})]}),e.jsx("div",{className:"divide-y divide-surface/10",children:o.length>0?o.map(t=>e.jsxs("div",{className:"flex items-center px-4 py-3 group hover:bg-surface/10 transition-colors",children:[e.jsx("div",{className:"flex-grow min-w-0",children:e.jsx("p",{className:"font-medium text-surface truncate",children:t.title})}),e.jsx("div",{className:"w-40 text-center text-surface/80",children:t.trashedAt?_(new Date(t.trashedAt.seconds*1e3),"MMM d, yyyy"):"N/A"}),e.jsxs("div",{className:"w-32 flex justify-center gap-1",children:[e.jsx(m,{variant:"ghost",size:"icon",onClick:()=>b(t.id),title:"Restore",className:"h-8 w-8 text-green-400/70 hover:text-green-400",children:e.jsx(F,{size:16})}),e.jsx(m,{variant:"ghost",size:"icon",onClick:()=>A(t.id),title:"Delete Permanently",className:"h-8 w-8 text-red-400/70 hover:text-red-400",children:e.jsx(R,{size:16})})]})]},t.id)):e.jsx("p",{className:"text-surface/60 p-8 text-center",children:"The trash is empty."})})]})]}):e.jsxs("div",{className:"flex flex-col justify-center items-center h-[50vh] text-center",children:[e.jsx(S,{className:"text-red-400 mb-4",size:48}),e.jsx("h1",{className:"text-3xl font-bold",children:"Access Denied"}),e.jsx("p",{className:"text-muted mt-2",children:"You do not have permission to view this page. Redirecting..."})]})}export{G as default};
